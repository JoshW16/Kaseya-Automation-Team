<?xml version="1.0" encoding="utf-8"?>
<ScriptExport xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns="http://www.kaseya.com/vsa/2008/12/Scripting">
  <Folder name="PS - File and Folder Tools" treePres="3">
    <Procedure name="PS - Get Last Modified Date for File or Folder" treePres="3" id="905432440" folderId="130845650113581" treeFullPath="Kaseya Professional Services.IT Toolkit Series.PS - File and Folder Tools">
      <Body description="">
        <Statement description="Replace variable values to 1. Target file or folder. 2. Days to  test if folder or file has not been modified for x days." name="GetVariable" continueOnFail="false">
          <Parameter xsi:type="EnumParameter" name="VariableType" value="ConstantValue" />
          <Parameter xsi:type="StringParameter" name="SourceContent" value="c:\TargetFolder" />
          <Parameter xsi:type="StringParameter" name="VariableName" value="folder" />
        </Statement>
        <Statement name="GetVariable" continueOnFail="false">
          <Parameter xsi:type="EnumParameter" name="VariableType" value="ConstantValue" />
          <Parameter xsi:type="StringParameter" name="SourceContent" value="5" />
          <Parameter xsi:type="StringParameter" name="VariableName" value="daysold" />
        </Statement>
        <Statement name="GetVariable" continueOnFail="false">
          <Parameter xsi:type="EnumParameter" name="VariableType" value="AgentTempSystemDirectory" />
          <Parameter xsi:type="StringParameter" name="SourceContent" value="" />
          <Parameter xsi:type="StringParameter" name="VariableName" value="kwork" />
        </Statement>
        <Statement name="WriteFile" continueOnFail="false">
          <Parameter xsi:type="StringParameter" name="Path" value="#kwork#\GetLastModifiedDate.ps1" />
          <Parameter xsi:type="StringParameter" name="ManagedFile" value="VSASharedFiles\Kaseya Automation Team\GetLastModifiedDate.ps1" />
          <Parameter xsi:type="BooleanParameter" name="DeleteAfter" value="False" />
        </Statement>
        <Statement name="Execute Shell Command - Get Results to Variable" continueOnFail="false">
          <Parameter xsi:type="StringParameter" name="Parameter1" value="powershell -ExecutionPolicy Bypass -File #kwork#\GetLastModifiedDate.ps1 #folder# #daysold#" />
          <Parameter xsi:type="StringParameter" name="Parameter2" value="True" />
          <Parameter xsi:type="StringParameter" name="Parameter3" value="System" />
        </Statement>
        <Statement name="WriteScriptLogEntry" continueOnFail="false">
          <Parameter xsi:type="StringParameter" name="Comment" value="#global:cmdresults#" />
        </Statement>
      </Body>
    </Procedure>
    <Procedure name="PS - Linux - Delete files older than x days" treePres="3" id="2098318067" folderId="130845650113581" treeFullPath="Kaseya Professional Services.IT Toolkit Series.PS - File and Folder Tools">
      <Body description="">
        <Statement description="Replace variable values to 1. Target folder. 2. Days old to  delete files older than x days." name="GetVariable" continueOnFail="false">
          <Parameter xsi:type="EnumParameter" name="VariableType" value="AgentTempDirectory" />
          <Parameter xsi:type="StringParameter" name="SourceContent" value="" />
          <Parameter xsi:type="StringParameter" name="VariableName" value="kwork" />
        </Statement>
        <Statement name="GetVariable" continueOnFail="false">
          <Parameter xsi:type="EnumParameter" name="VariableType" value="ConstantValue" />
          <Parameter xsi:type="StringParameter" name="SourceContent" value="EnterFolderPath" />
          <Parameter xsi:type="StringParameter" name="VariableName" value="folder" />
        </Statement>
        <Statement name="GetVariable" continueOnFail="false">
          <Parameter xsi:type="EnumParameter" name="VariableType" value="ConstantValue" />
          <Parameter xsi:type="StringParameter" name="SourceContent" value="EnterNumberofDays" />
          <Parameter xsi:type="StringParameter" name="VariableName" value="daysold" />
        </Statement>
        <Statement name="ExecuteShellCommand" continueOnFail="false">
          <Parameter xsi:type="StringParameter" name="Command" value="find #folder#. -mtime +#daysold# -print &gt;&gt; #kwork#/FilesDeleted.txt" />
          <Parameter xsi:type="EnumParameter" name="ExecuteAccount" value="System" />
          <Parameter xsi:type="BooleanParameter" name="Is64Bit" value="False" />
        </Statement>
        <Statement name="ExecuteShellCommand" continueOnFail="false">
          <Parameter xsi:type="StringParameter" name="Command" value="find #folder#/. -mtime +#daysold# -exec rm -f {} \;" />
          <Parameter xsi:type="EnumParameter" name="ExecuteAccount" value="System" />
          <Parameter xsi:type="BooleanParameter" name="Is64Bit" value="False" />
        </Statement>
      </Body>
    </Procedure>
    <Procedure name="PS - Monitor Folder Size" treePres="3" id="179678240" folderId="130845650113581" treeFullPath="Kaseya Professional Services.IT Toolkit Series.PS - File and Folder Tools">
      <Body description="">
        <Statement name="GetVariable" continueOnFail="false">
          <Parameter xsi:type="EnumParameter" name="VariableType" value="AgentTempSystemDirectory" />
          <Parameter xsi:type="StringParameter" name="SourceContent" value="" />
          <Parameter xsi:type="StringParameter" name="VariableName" value="kwork" />
        </Statement>
        <Statement name="GetVariable" continueOnFail="false">
          <Parameter xsi:type="EnumParameter" name="VariableType" value="ConstantValue" />
          <Parameter xsi:type="StringParameter" name="SourceContent" value="c:\users" />
          <Parameter xsi:type="StringParameter" name="VariableName" value="folder" />
        </Statement>
        <Statement name="GetVariable" continueOnFail="false">
          <Parameter xsi:type="EnumParameter" name="VariableType" value="ConstantValue" />
          <Parameter xsi:type="StringParameter" name="SourceContent" value="GB" />
          <Parameter xsi:type="StringParameter" name="VariableName" value="unit" />
        </Statement>
        <Statement description="Enter Amount in MB or GB for Folder Size Threshold" name="GetVariable" continueOnFail="false">
          <Parameter xsi:type="EnumParameter" name="VariableType" value="ConstantValue" />
          <Parameter xsi:type="StringParameter" name="SourceContent" value="50" />
          <Parameter xsi:type="StringParameter" name="VariableName" value="FolderSize" />
        </Statement>
        <Statement name="GetVariable" continueOnFail="false">
          <Parameter xsi:type="EnumParameter" name="VariableType" value="ConstantValue" />
          <Parameter xsi:type="StringParameter" name="SourceContent" value="emailadd@yourcompany.com" />
          <Parameter xsi:type="StringParameter" name="VariableName" value="email" />
        </Statement>
        <Statement name="GetVariable" continueOnFail="false">
          <Parameter xsi:type="EnumParameter" name="VariableType" value="MachineGroupID" />
          <Parameter xsi:type="StringParameter" name="SourceContent" value="" />
          <Parameter xsi:type="StringParameter" name="VariableName" value="MachineID" />
        </Statement>
        <Statement name="WriteFile" continueOnFail="false">
          <Parameter xsi:type="StringParameter" name="Path" value="#kwork#\GetFolderSize.ps1" />
          <Parameter xsi:type="StringParameter" name="ManagedFile" value="VSASharedFiles\Kaseya Automation Team\GetFolderSize.ps1" />
          <Parameter xsi:type="BooleanParameter" name="DeleteAfter" value="False" />
        </Statement>
        <Statement name="Execute Shell Command - Get Results to Variable" continueOnFail="false" osType="Windows">
          <Parameter xsi:type="StringParameter" name="Parameter1" value="powershell -ExecutionPolicy Bypass -File #kwork#\GetFolderSize.ps1 #folder# 1#unit#" />
          <Parameter xsi:type="StringParameter" name="Parameter2" value="True" />
          <Parameter xsi:type="StringParameter" name="Parameter3" value="System" />
        </Statement>
        <If description="">
          <Condition name="CheckVariable">
            <Parameter xsi:type="StringParameter" name="VariableName" value="#global:cmdresults#" />
            <Parameter xsi:type="EnumParameter" name="Condition" value="GreaterThan" />
            <Parameter xsi:type="StringParameter" name="Value" value="#FolderSize#" />
          </Condition>
          <Then>
            <Statement name="WriteScriptLogEntry" continueOnFail="false">
              <Parameter xsi:type="StringParameter" name="Comment" value="Greater than threshold #MachineID# - #folder# folder - #global:cmdresults# #unit#" />
            </Statement>
            <Statement name="SendEmail" continueOnFail="false" osType="None">
              <Parameter xsi:type="StringParameter" name="To" value="#email#" />
              <Parameter xsi:type="StringParameter" name="Subject" value="#MachineID# - #folder# folder Size #global:cmdresults# MB" />
              <Parameter xsi:type="MultiLineStringParameter" name="Body" value="#MachineID# - #folder# folder Size is at #global:cmdresults# MB&#xA;Threshold set at #FolderSize# MB" />
            </Statement>
          </Then>
          <Else>
            <Statement name="WriteScriptLogEntry" continueOnFail="false">
              <Parameter xsi:type="StringParameter" name="Comment" value="#folder# Less than #FolderSize# #unit#" />
            </Statement>
          </Else>
        </If>
      </Body>
    </Procedure>
    <Procedure name="PS - Monitor Folder Size with Delete Old Files" treePres="3" id="1523957430" folderId="130845650113581" treeFullPath="Kaseya Professional Services.IT Toolkit Series.PS - File and Folder Tools">
      <Body description="">
        <Statement name="GetVariable" continueOnFail="false">
          <Parameter xsi:type="EnumParameter" name="VariableType" value="AgentTempSystemDirectory" />
          <Parameter xsi:type="StringParameter" name="SourceContent" value="" />
          <Parameter xsi:type="StringParameter" name="VariableName" value="kwork" />
        </Statement>
        <Statement name="GetVariable" continueOnFail="false">
          <Parameter xsi:type="EnumParameter" name="VariableType" value="ConstantValue" />
          <Parameter xsi:type="StringParameter" name="SourceContent" value="c:\temp\old" />
          <Parameter xsi:type="StringParameter" name="VariableName" value="folder" />
        </Statement>
        <Statement name="GetVariable" continueOnFail="false">
          <Parameter xsi:type="EnumParameter" name="VariableType" value="ConstantValue" />
          <Parameter xsi:type="StringParameter" name="SourceContent" value="MB" />
          <Parameter xsi:type="StringParameter" name="VariableName" value="unit" />
        </Statement>
        <Statement description="Enter Amount in MB or GB for Folder Size Threshold" name="GetVariable" continueOnFail="false">
          <Parameter xsi:type="EnumParameter" name="VariableType" value="ConstantValue" />
          <Parameter xsi:type="StringParameter" name="SourceContent" value="20" />
          <Parameter xsi:type="StringParameter" name="VariableName" value="FolderSize" />
        </Statement>
        <Statement name="GetVariable" continueOnFail="false">
          <Parameter xsi:type="EnumParameter" name="VariableType" value="ConstantValue" />
          <Parameter xsi:type="StringParameter" name="SourceContent" value="15" />
          <Parameter xsi:type="StringParameter" name="VariableName" value="days" />
        </Statement>
        <Statement name="GetVariable" continueOnFail="false">
          <Parameter xsi:type="EnumParameter" name="VariableType" value="ConstantValue" />
          <Parameter xsi:type="StringParameter" name="SourceContent" value="emailadd@yourcompany.com" />
          <Parameter xsi:type="StringParameter" name="VariableName" value="email" />
        </Statement>
        <Statement name="GetVariable" continueOnFail="false">
          <Parameter xsi:type="EnumParameter" name="VariableType" value="MachineGroupID" />
          <Parameter xsi:type="StringParameter" name="SourceContent" value="" />
          <Parameter xsi:type="StringParameter" name="VariableName" value="MachineID" />
        </Statement>
        <Statement name="WriteFile" continueOnFail="false">
          <Parameter xsi:type="StringParameter" name="Path" value="#kwork#\GetFolderSize.ps1" />
          <Parameter xsi:type="StringParameter" name="ManagedFile" value="VSASharedFiles\Kaseya Automation Team\GetFolderSize.ps1" />
          <Parameter xsi:type="BooleanParameter" name="DeleteAfter" value="False" />
        </Statement>
        <Statement name="Execute Shell Command - Get Results to Variable" continueOnFail="false" osType="Windows">
          <Parameter xsi:type="StringParameter" name="Parameter1" value="powershell -ExecutionPolicy Bypass -File #kwork#\GetFolderSize.ps1 #folder# 1#unit#" />
          <Parameter xsi:type="StringParameter" name="Parameter2" value="True" />
          <Parameter xsi:type="StringParameter" name="Parameter3" value="System" />
        </Statement>
        <If description="">
          <Condition name="CheckVariable">
            <Parameter xsi:type="StringParameter" name="VariableName" value="#global:cmdresults#" />
            <Parameter xsi:type="EnumParameter" name="Condition" value="GreaterThan" />
            <Parameter xsi:type="StringParameter" name="Value" value="#FolderSize#" />
          </Condition>
          <Then>
            <Statement name="WriteScriptLogEntry" continueOnFail="false">
              <Parameter xsi:type="StringParameter" name="Comment" value="Greater than threshold #MachineID# - #folder# folder - #global:cmdresults# #unit#" />
            </Statement>
            <Statement name="ExecuteShellCommand" continueOnFail="false">
              <Parameter xsi:type="StringParameter" name="Command" value="powershell &quot;Get-ChildItem -Path &quot;#folder#&quot; | Where-Object {$_.LastWriteTime -lt (Get-Date).AddDays(-#days#)}&quot; &gt;&gt; #kwork#\filesdeleted.txt" />
              <Parameter xsi:type="EnumParameter" name="ExecuteAccount" value="System" />
              <Parameter xsi:type="BooleanParameter" name="Is64Bit" value="True" />
            </Statement>
            <Statement name="ExecuteShellCommand" continueOnFail="false">
              <Parameter xsi:type="StringParameter" name="Command" value="powershell &quot;Get-ChildItem -Path &quot;#folder#&quot; | Where-Object {$_.LastWriteTime -lt (Get-Date).AddDays(-#days#)} | Remove-Item -Force&quot;" />
              <Parameter xsi:type="EnumParameter" name="ExecuteAccount" value="System" />
              <Parameter xsi:type="BooleanParameter" name="Is64Bit" value="True" />
            </Statement>
            <Statement name="SendEmail" continueOnFail="false" osType="None">
              <Parameter xsi:type="StringParameter" name="To" value="#email#" />
              <Parameter xsi:type="StringParameter" name="Subject" value="#MachineID# - #folder# folder Size #global:cmdresults# MB" />
              <Parameter xsi:type="MultiLineStringParameter" name="Body" value="#MachineID# - #folder# folder Size is at #global:cmdresults# MB&#xA;Threshold set at #FolderSize# MB" />
            </Statement>
          </Then>
          <Else>
            <Statement name="WriteScriptLogEntry" continueOnFail="false">
              <Parameter xsi:type="StringParameter" name="Comment" value="#folder# Less than #FolderSize# #unit#" />
            </Statement>
          </Else>
        </If>
      </Body>
    </Procedure>
  </Folder>
</ScriptExport>